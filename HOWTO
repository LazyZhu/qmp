
######## HOWTO:


#### BUILD:

mkdir -p 13f # or however you want to name your working directory
cd 13f

git clone ssh://gitosis@qmp.cat:221/qmp.git; cd qmp; git checkout --track origin/ipv6-routing-prototype; cd ..
svn co svn://svn.openwrt.org/openwrt/branches/backfire
git clone git://gitorious.org/eigennet/packages.git eigennet/packages


cd backfire
rm -rf feeds/
ln -s ../../dl # wherever you already have some openwrt downloads...
ln -s ../qmp/files
ln -s ../qmp/feeds.conf

nano feeds.conf  # adapt path to .../13f/packages

./scripts/feeds update -a
./scripts/feeds install -a

## Only for HT40+ (MiMo) and ath9k
mv ../qmp/files/etc/config/wireless ../qmp/files/etc/config/wireless_g
mv ../qmp/files/etc/config/wireless_n ../qmp/files/etc/config/wireless

## Configuring system
make menuconfig
* Target System  (BCM947xxx, x86, atheros,...)
* Target Profile (WGT634u, wrap, alix, routerstation,...) 
(* Global build-settings -> Compile teh kernel with profiling enabled )
(* Advanced configuration options for developers -> Toolchain options -> Build gdb )
* Base system ->
    qmp-big-node # for 8Mbyte flash devices  
    qmp-small-node # for 4MByte flash devices STILL TO BIG due to ipv6calc!!! Dont TEST
		#(* LuCI -> Freifunk -> luci-mod-freifunk-community  ) 

* remove for 4MByte-flash devices: network -> ppp
* remove for 4MByte-flash devices: network -> ppad-mini

## Patching files
cp ../qmp/patches/004-ibss.patch package/mac80211/patches/
cp ../qmp/patches/002-ibss_ht40.patch package/iw/patches/
patch -p1 -i ../qmp/patches/mac80211.sh_ht40.patch package/mac80211/files/lib/wifi/mac80211.sh 

## Compiling
make kernel_menuconfig 
(* General Setup -> Small Systems -> ELF Core dumps )
(* Networking -> options -> IPv6 -> routing-tables  )

time make V=99

#### INSTALL:

## wgt634u: (tested)
scp bin/brcm47xx/openwrt-brcm47xx-squashfs.trx root@192.168.1.1:/tmp/
ssh root@192.168.1.1
mtd -r write /tmp/openwrt-brcm47xx-squashfs.trx linux # do not reboot for a while to let filesystem cleanup

## fonera: (tested)
scp bin/atheros/openwrt-atheros-vmlinux.lzma bin/atheros/openwrt-atheros-root.squashfs root@192.168.1.1:/tmp/
ssh root@192.168.1.1
mtd -e vmlinux.bin.l7 write /tmp/openwrt-atheros-vmlinux.lzma vmlinux.bin.l7
mtd -r -e rootfs write /tmp/openwrt-atheros-root.squashfs rootfs



## alix: (untested)
sudo dd if=bin/x86/openwrt-x86-generic-combined-squashfs.img of=/dev/sdX


## routerstation: (untested) 



#### POSTCONFIGURE:

ssh root@192.168.1.1

vi /etc/config/qmp # adapt to your hardware (only tested for fonera, wgt634u yet!)

. /etc/qmp_functions.sh

qmp_configure
# or configure individually:
# qmp_configure_network
# qmp_configure_olsr6
# qmp_configure_bmx6
# qmp_configure_system

uci set wireless.radio0.macaddr=$(qmp_get_mac_for_dev wlan0)
uci commit

reboot 
# or restart stuff manually:
# /etc/init.d/network restart
# /etc/init.d/olsrd restart
# /etc/init.d/bmx6 restart
