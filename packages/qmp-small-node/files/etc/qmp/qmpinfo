#!/usr/bin/lua
--[[
    Copyright (C) 2011 FundaciÃ³ Privada per a la Xarxa Oberta, Lliure i Neutral guifi.net

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License along
    with this program; if not, write to the Free Software Foundation, Inc.,
    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

    The full GNU General Public License is included in this distribution in
    the file called "COPYING".
--]]

package.path = package.path .. ";/etc/qmp/?.lua"

qmp = require "qmpinfo"

function print_help()
	print("qMpinfo -> a dummy lua script to get some information about the wireless devices")
	print("Usage: qmpinfo <question> <device>")
	print("Possible questions:")
	print("		modes: supported modes by the wireless card")
	print("		channels: supported channels and supported HT40 type (+/-) ")
	print("")
end

function print_modes()
	local data = qmp.get_modes(dev)
	local output = ""
    if data.b  then output = output .. "b " end
    if data.g  then output = output .. "g " end
    if data.a  then output = output .. "a " end
    if data.n  then output = output .. "n " end
	print(output)
end

function print_channels()
	local partial
	local output = ""
	local data = qmp.get_channels(dev)
	for _,d in ipairs(data) do
		output = d.channel
		if d.ht40p then output = output .. " ht40+" end
		if d.ht40m then output = output .. " ht40-" end
		if d.adhoc then output = output .. " adhoc" end
		print(output)
	end
end
	
if #arg ~= 2 then
	print_help()
	os.exit(1)
end

local question = arg[1]
dev = arg[2]

if question == "modes" then
	print_modes()

elseif question == "channels" then
	print_channels()
else
	print_help()
end

